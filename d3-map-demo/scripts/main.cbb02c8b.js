!function(a){var b=d3_queue.queue,c=d3.map(),d=600,e=500,f=d3.select("#map").append("svg").attr("width",d).attr("height",e),g=d3.geo.mercator().scale(390).translate([.5*d,1.45*e]),h=d3.geo.path().projection(g),i=3,j=30,k="#bcbddc",l="#990000",m=d3.scale.linear().domain([i,j]).range([k,l]),n=320,o=d3.scale.linear().domain([0,100]).range([0,n]),p=function(a,b){var d=topojson.feature(b,b.objects.ne_110m_admin_0_countries);f.selectAll("path").data(d.features).enter().append("path").attr("fill",function(a){var b=c.get(a.id);return"undefined"!=typeof b&&b.gap?m(b.gap):"#eee"}).attr("class",function(a){return a.id+" country"}).attr("stroke","#000").attr("d",h),d3.selectAll("path.country").on("click",function(a){var b,d=c.get(a.id);if("undefined"!=typeof d){b="<h2>"+d.country+"</h2>",b+="<h3>Workplace participation rates</h3>",d3.select("#info").html("").append("div").html(b);var e=d3.select("#info").append("svg").attr("width",n).attr("height",80).append("g").selectAll("rect").data([d.fpr,d.mpr]).enter();if(e.append("rect").attr("y",function(a,b){return 38*b}).attr("x",0).attr("height",20).style("fill","#ddd").attr("width",n),e.insert("rect").attr("y",function(a,b){return 38*b}).attr("x",0).attr("height",20).style("fill",function(a,b){return 1>b?"rgb(223, 101, 176)":"rgb(33, 113, 181)"}).attr("width",o),e.insert("text").attr("y",function(a,b){return 38*b+15}).attr("x",5).attr("height",20).attr("width",n).attr("fill","white").style("color","white").text(function(a){return parseFloat(a).toFixed(2)+"%"}),d.gap){b="<h3>Wage gap</h3>",d3.select("#info").append("div").html(b);var e=d3.select("#info").append("svg").attr("width",n).attr("height",80).append("g").selectAll("rect").data([100-d.gap,100]).enter();e.append("rect").attr("y",function(a,b){return 38*b}).attr("x",0).attr("height",20).style("fill","#ddd").attr("width",n),e.insert("rect").attr("y",function(a,b){return 38*b}).attr("x",0).attr("height",20).style("fill",function(a,b){return 1>b?"rgb(223, 101, 176)":"rgb(33, 113, 181)"}).attr("width",o),e.insert("text").attr("y",function(a,b){return 38*b+15}).attr("x",5).attr("height",20).attr("width",n).attr("fill","white").style("color","white").text(function(a){return parseFloat(a).toFixed(2)+"%"})}}})};a.init=function(){b().defer(d3.json,"data/world.topojson").defer(d3.csv,"data/gender_gap.csv",function(a){return c.set(a.iso3,a),a}).await(p)}}(window.map=window.map||{}),map.init();